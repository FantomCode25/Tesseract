<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Safety Tracker</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <!-- Firebase Config -->
    <script src="firebase-config.js"></script>
    <!-- Authentication Check -->
    <script>
        // Check if user is logged in
        document.addEventListener('DOMContentLoaded', function() {
            firebase.auth().onAuthStateChanged(function(user) {
                if (!user) {
                    // User is not signed in, redirect to login page
                    console.log('User not authenticated, redirecting to login');
                    window.location.href = 'auth.html';
                } else {
                    console.log('User logged in:', user.displayName || user.email);
                    
                    // Fetch additional user data from Firestore
                    firebase.firestore().collection('users').doc(user.uid).get()
                        .then((doc) => {
                            if (doc.exists) {
                                const userData = doc.data();
                                console.log('User data fetched:', userData);
                                
                                // Update last active timestamp
                                firebase.firestore().collection('users').doc(user.uid).update({
                                    lastActive: firebase.firestore.FieldValue.serverTimestamp()
                                }).catch(err => console.error('Error updating last active timestamp:', err));
                                
                                // Update UI with user data
                                updateUserProfile(user, userData);
                            } else {
                                console.log('No user data found, creating new profile');
                                // Create user data if it doesn't exist
                                firebase.firestore().collection('users').doc(user.uid).set({
                                    displayName: user.displayName || 'User',
                                    email: user.email,
                                    photoURL: user.photoURL || '',
                                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                                    lastActive: firebase.firestore.FieldValue.serverTimestamp()
                                }).then(() => {
                                    console.log('New user profile created');
                                    // Still update UI with available data
                                    updateUserProfile(user, {});
                                }).catch(err => console.error('Error creating user profile:', err));
                            }
                        })
                        .catch((error) => {
                            console.error('Error fetching user data:', error);
                            // Still update UI with basic auth data
                            updateUserProfile(user, {});
                        });
                }
            });
        });
        
        // Update user profile display in sidebar
        function updateUserProfile(user, userData) {
            // Update user name in sidebar
            const userNameElement = document.querySelector('.user-info h6');
            if (userNameElement) {
                userNameElement.textContent = userData.displayName || user.displayName || user.email.split('@')[0] || 'User';
            }
            
            // Update user image in sidebar if available
            const userAvatarElement = document.querySelector('.user-avatar');
            if (userAvatarElement) {
                const photoURL = userData.photoURL || user.photoURL;
                if (photoURL) {
                    userAvatarElement.src = photoURL;
                } else {
                    // Set default avatar with user's initial
                    const initial = (userData.displayName || user.displayName || user.email.split('@')[0] || 'U').charAt(0).toUpperCase();
                    userAvatarElement.src = `https://ui-avatars.com/api/?name=${initial}&background=FF6B6B&color=fff&size=100`;
                }
            }
            
            // Update user status in sidebar if applicable
            const userStatusElement = document.querySelector('.user-info small');
            if (userStatusElement && userData.userType) {
                userStatusElement.textContent = userData.userType === 'premium' ? 'Premium Member' : 'Community Member';
            }
        }
    </script>
    
    <!-- Load Google Maps API after the document is ready -->
    <script>
        // Only load Google Maps after DOM is ready to avoid race conditions
        document.addEventListener('DOMContentLoaded', function() {
            // Check if Google Maps API is already loaded to prevent duplicate initialization
            if (window.google && window.google.maps) {
                console.log('Google Maps API already loaded');
                // If already loaded, initialize the map
                if (typeof initMap === 'function') {
                    initMap();
                }
                return;
            }
            
            console.log('Loading Google Maps API...');
            // Create the script element
            const script = document.createElement('script');
            script.src = 'https://maps.googleapis.com/maps/api/js?key=AIzaSyBzOkTzsKOkKwcaPJqxHF8eMqm5dc3LsMg&libraries=places,directions,visualization&callback=googleMapsCallback';
            script.async = true;
            script.defer = true;
            
            // Add the callback function to window
            window.googleMapsCallback = function() {
                console.log('Google Maps API loaded successfully');
                if (typeof initMap === 'function') {
                    initMap();
                }
            };
            
            // Append the script to the document
            document.head.appendChild(script);
        });
    </script>
    
    <link rel="stylesheet" href="styles.css">
    <style>
        :root {
            --gradient-start: #FF9A8B;
            --gradient-middle: #FF6B6B;
            --gradient-end: #FFA07A; 
            --text-dark: #2D3436;
            --text-light: #ffffff;
            --sidebar-width: 280px;
            --header-height: 70px;
            --transition-smooth: cubic-bezier(0.4, 0, 0.2, 1);
        }

        body {
            font-family: 'Poppins', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            color: var(--text-dark);
            line-height: 1.6;
            background: #f8fafc;
            overflow-x: hidden;
            display: flex;
            min-height: 100vh;
        }

        /* Gradient Background Effects */
        .gradient-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: linear-gradient(-45deg, var(--gradient-start), var(--gradient-middle), var(--gradient-end));
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
            opacity: 0.05;
        }

        .gradient-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: radial-gradient(circle at var(--mouse-x, 50%) var(--mouse-y, 50%), 
                rgba(255, 255, 255, 0.1) 0%, 
                rgba(255, 255, 255, 0.05) 25%, 
                transparent 50%);
            pointer-events: none;
        }

        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Dashboard Layout */
        .dashboard-container {
            display: flex;
            width: 100%;
            position: relative;
            min-height: 100vh;
        }

        /* Sidebar Styling */
        .sidebar {
            width: var(--sidebar-width);
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            border-right: 1px solid rgba(0, 0, 0, 0.1);
            padding: 2rem;
            transition: transform 0.3s var(--transition-smooth);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        .sidebar-header {
            padding: 0 0 1.5rem 0;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .sidebar-brand {
            font-weight: 700;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-middle));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .sidebar-menu {
            list-style: none;
            padding: 0;
            margin: 0;
            overflow-y: auto;
        }

        .sidebar-menu-item {
            margin-bottom: 0.5rem;
        }

        .sidebar-menu-link {
            display: flex;
            align-items: center;
            padding: 1rem 1.25rem;
            border-radius: 12px;
            color: var(--text-dark);
            transition: all 0.3s ease;
            text-decoration: none;
            font-weight: 500;
            gap: 1rem;
        }

        .sidebar-menu-link:hover {
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-middle));
            color: white;
            transform: translateX(5px);
        }

        .sidebar-menu-link.active {
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-middle));
            color: white;
        }

        .sidebar-menu-icon {
            width: 24px;
            font-size: 1.2rem;
        }

        .sidebar-footer {
            margin-top: auto;
            padding: 1rem 0;
            border-top: 1px solid rgba(0, 0, 0, 0.1);
        }

        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            padding: calc(var(--header-height) + 2rem) 2.5rem 2.5rem 2.5rem;
            width: calc(100% - var(--sidebar-width));
            position: relative;
        }

        /* Header Bar */
        .header-bar {
            position: fixed;
            top: 0;
            right: 0;
            left: var(--sidebar-width);
            height: var(--header-height);
            background: white;
            z-index: 99;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 2.5rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }

        .header-bar h4 {
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-middle));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-weight: 600;
            font-size: 1.35rem;
        }

        /* Toggle Button for Mobile */
        .sidebar-toggle {
            position: fixed;
            top: 1rem;
            left: 1rem;
            z-index: 10001;
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-middle));
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: none;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(255, 107, 107, 0.5);
            transition: all 0.3s ease;
            font-size: 1.25rem;
            opacity: 1;
        }

        .sidebar-toggle:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.6);
            background: linear-gradient(135deg, var(--gradient-middle), var(--gradient-start));
        }

        .mobile-toggle {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 10001;
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-middle));
            color: white;
            border: none;
            padding: 0;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: none;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(255, 107, 107, 0.5);
            transition: all 0.3s ease;
            font-size: 1.25rem;
            opacity: 1;
        }
        
        .mobile-toggle:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.6);
            background: linear-gradient(135deg, var(--gradient-middle), var(--gradient-start));
        }

        /* Mobile Navigation Overlay */
        .mobile-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(3px);
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .mobile-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        /* Responsive Adjustments */
        @media (max-width: 991px) {
            .sidebar {
                transform: translateX(-100%);
                width: 280px !important;
                height: 100vh !important;
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                z-index: 99998 !important; /* Very high z-index */
                box-shadow: 0 0 30px rgba(0, 0, 0, 0.2) !important;
                overflow-y: auto !important;
                transition: transform 0.3s ease !important;
                background-color: rgba(255, 255, 255, 0.98) !important;
                backdrop-filter: blur(10px) !important;
                padding: 2rem 1.5rem !important;
            }
            
            .sidebar.active {
                transform: translateX(0) !important;
                display: block !important;
                visibility: visible !important;
                opacity: 1 !important;
            }
            
            .main-content {
                margin-left: 0 !important;
                width: 100%;
                padding-top: calc(var(--header-height) + 1rem);
                padding-left: 1.5rem;
                padding-right: 1.5rem;
            }
            
            .header-bar {
                left: 0 !important;
                padding: 0 70px !important;
            }
            
            .sidebar-toggle {
                display: flex !important;
                top: 10px;
                left: 10px;
            }

            .mobile-toggle {
                display: flex !important;
                top: 10px;
                right: 10px;
            }
            
            .quick-actions-panel {
                width: 280px;
            }
            
            /* Additional styling for sidebar */
            .sidebar nav {
                margin-top: 1rem !important;
                display: flex !important;
                flex-direction: column !important;
            }
            
            .sidebar .nav-link {
                margin-bottom: 0.75rem !important;
                width: 100% !important;
                opacity: 1 !important;
            }
            
            .sidebar .nav-link span {
                color: inherit !important;
                font-weight: 600 !important;
            }
        }

        @media (max-width: 767px) {
            .main-content {
                padding: calc(var(--header-height) + 1rem) 1.25rem 1.25rem 1.25rem;
            }

            .header-bar {
                padding: 0 70px;
            }

            .sidebar {
                width: 280px;
                padding: 1.5rem;
            }
            
            .sidebar-toggle {
                background: linear-gradient(135deg, var(--gradient-start), var(--gradient-middle));
                box-shadow: 0 5px 20px rgba(255, 107, 107, 0.7);
            }
            
            .mobile-toggle {
                width: 50px;
                height: 50px;
                padding: 0;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            .quick-actions-panel {
                width: 270px;
                padding: 1.5rem 1rem;
            }
            
            .quick-actions {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
        }

        @media (max-width: 576px) {
            .tracking-code {
                font-size: 1.75rem;
            }

            h4, .h4 {
                font-size: 1.3rem;
            }

            .header-bar h4 {
                font-size: 1.2rem;
            }

            .glass-card {
                padding: 1.25rem;
                margin-bottom: 1rem;
            }
            
            .btn {
                padding: 0.7rem 1rem;
                font-size: 0.95rem;
            }
            
            .form-control, .form-select {
                padding: 0.7rem 1rem;
                font-size: 0.95rem;
            }
            
            .form-label {
                font-size: 0.9rem;
            }
            
            .dropdown-menu {
                min-width: 220px;
            }
            
            .dropdown-item {
                padding: 0.4rem 0.75rem;
                font-size: 0.8rem;
            }
            
            .sidebar {
                padding: 1.25rem;
                width: 250px;
            }
            
            .sidebar-brand {
                font-size: 1.3rem;
            }
            
            .sidebar-menu-link {
                padding: 0.75rem 1rem;
                font-size: 0.9rem;
            }
            
            .sidebar-menu-icon {
                width: 20px;
                font-size: 1rem;
            }
            
            .quick-actions-panel {
                width: 85%;
                max-width: 260px;
            }
            
            .action-button {
                padding: 1rem;
            }
            
            .header-bar {
                padding: 0 60px;
            }
        }

        /* Cards and Components */
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 24px;
            padding: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            margin-bottom: 1.5rem;
        }

        .glass-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .card {
            background: white;
            border-radius: 24px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            margin-bottom: 30px;
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        /* Buttons */
        .btn-start-tracking {
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-middle));
            border: none;
            color: var(--text-light);
            padding: 12px 30px;
            border-radius: 12px;
            font-weight: 500;
            font-size: 1rem;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
        }

        .btn-start-tracking:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(255, 107, 107, 0.4);
            background: linear-gradient(135deg, var(--gradient-middle), var(--gradient-start));
        }

        .btn-end-tracking {
            background: linear-gradient(135deg, #FF6B6B, #FF4545);
            border: none;
            color: var(--text-light);
            padding: 12px 30px;
            border-radius: 12px;
            font-weight: 500;
            font-size: 1rem;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
        }

        .btn-end-tracking:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(255, 107, 107, 0.4);
            background: linear-gradient(135deg, #FF4545, #FF6B6B);
        }

        /* Primary Button */
        .btn-primary {
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-middle));
            border: none;
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(255, 107, 107, 0.4);
            background: linear-gradient(135deg, var(--gradient-middle), var(--gradient-start));
        }

        .btn-info {
            background: linear-gradient(135deg, #11cdef, #1171ef);
            border: none;
            box-shadow: 0 5px 15px rgba(17, 205, 239, 0.3);
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .btn-info:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(17, 205, 239, 0.4);
        }

        .dropdown-menu {
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            border: 0;
            padding: 0.5rem;
            border-radius: 12px;
        }

        .dropdown-item {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            border-radius: 0.5rem;
            transition: all 0.2s ease;
        }

        .dropdown-item:hover {
            background-color: rgba(255, 107, 107, 0.1);
            transform: translateX(5px);
        }

        /* Animation Effects */
        .scale-in {
            animation: scaleIn 0.5s cubic-bezier(0.165, 0.84, 0.44, 1) forwards;
        }

        @keyframes scaleIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }

        /* Tracking Elements */
        .tracking-code {
            font-size: 2rem;
            font-weight: bold;
            text-align: center;
            padding: 1.5rem;
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-middle));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin: 1rem 0;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .map-placeholder {
            width: 100%;
            height: 300px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 24px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin: 1rem 0;
            border: 1px solid rgba(0, 0, 0, 0.1);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }

        .map-placeholder:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .status-indicator {
            padding: 1.5rem;
            border-radius: 24px;
            margin: 1rem 0;
            text-align: center;
            font-weight: 600;
            transition: all 0.3s ease;
            background: white;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .status-safe {
            background: rgba(45, 206, 137, 0.1);
            border-color: rgba(45, 206, 137, 0.3);
            color: #2DCE89;
        }

        .status-danger {
            background: rgba(255, 107, 107, 0.1);
            border-color: rgba(255, 107, 107, 0.3);
            color: #FF6B6B;
        }

        .timer-display {
            font-size: 1.5rem;
            text-align: center;
            margin: 1rem 0;
            color: var(--text-dark);
            padding: 1.5rem;
            background: white;
            border-radius: 24px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
        }

        .form-control, .form-select {
            border-radius: 12px;
            padding: 12px 20px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            background: white;
            font-family: 'Poppins', sans-serif;
        }

        .form-control:focus, .form-select:focus {
            box-shadow: 0 0 0 3px rgba(255, 107, 107, 0.2);
            border-color: var(--gradient-middle);
            background: white;
        }

        /* Sidebar Active State for Body */
        body.sidebar-active {
            overflow: hidden;
        }

        /* Quick Actions Grid */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2.5rem;
        }

        @media (max-width: 991px) {
            .quick-actions {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 1rem;
            }
        }
        
        @media (max-width: 767px) {
            .quick-actions {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .mobile-toggle {
                top: 10px;
                right: 10px;
                padding: 0.6rem;
            }
        }
        
        @media (max-width: 576px) {
            .quick-actions .glass-card {
                padding: 1rem;
            }
        }

        /* Quick Actions Panel */
        .quick-actions-panel {
            width: 280px;
            height: 100vh;
            background: white;
            position: fixed;
            top: 0;
            right: 0;
            z-index: 99998;
            padding: 2rem 1.5rem;
            overflow-y: auto;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            box-shadow: -10px 0 30px rgba(0, 0, 0, 0.1);
            border-top-left-radius: 20px;
            border-bottom-left-radius: 20px;
        }
        
        .quick-actions-panel.active {
            transform: translateX(0);
        }
        
        .quick-actions-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        .quick-actions-header h5 {
            font-weight: 600;
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-middle));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .quick-actions-header .btn-close {
            background-color: rgba(255, 107, 107, 0.1);
            opacity: 1;
            transition: all 0.3s ease;
        }
        
        .quick-actions-header .btn-close:hover {
            background-color: rgba(255, 107, 107, 0.2);
            transform: rotate(90deg);
        }

        /* Overlay for Quick Actions */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .overlay.active {
            opacity: 1;
            visibility: visible;
        }

        /* Action Buttons */
        .action-button {
            cursor: pointer;
            border: none;
            width: 100%;
            text-align: left;
            background: white;
            padding: 1.25rem;
            margin-bottom: 1rem;
            border-radius: 16px;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.03);
        }
        
        .action-button:hover {
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-middle));
            color: white;
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(255, 107, 107, 0.2);
        }
        
        .action-button:hover p.text-muted {
            color: rgba(255, 255, 255, 0.8) !important;
        }
        
        .action-button:hover i {
            color: white !important;
        }
        
        .action-icon {
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 154, 139, 0.1);
            border-radius: 12px;
            transition: all 0.3s ease;
        }
        
        .action-button:hover .action-icon {
            background: rgba(255, 255, 255, 0.2);
        }

        /* User Profile Styling */
        .user-profile {
            display: flex;
            align-items: center;
            padding: 1rem;
            margin-bottom: 1.5rem;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 16px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            margin-right: 1rem;
            object-fit: cover;
            border: 2px solid var(--gradient-middle);
        }
        
        .user-info h6 {
            margin: 0;
            font-weight: 600;
            font-size: 1.1rem;
            max-width: 180px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .user-info small {
            color: var(--gradient-middle);
            font-weight: 500;
            max-width: 180px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            display: block;
        }
        
        /* Navigation Links (Dashboard Style) */
        .nav-link {
            padding: 1rem 1.25rem;
            border-radius: 12px;
            color: var(--text-dark) !important;
            font-weight: 600 !important;
            transition: all 0.3s ease;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            text-decoration: none;
            font-size: 1.1rem !important;
        }
        
        .nav-link:hover,
        .nav-link.active {
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-middle)) !important;
            color: white !important;
            transform: translateX(5px);
        }
        
        .nav-link i {
            width: 24px;
            font-size: 1.2rem;
            color: inherit;
            margin-right: 0.5rem;
        }

        /* Quick Actions Panel Responsive Styles */
        @media (max-width: 991px) {
            .quick-actions-panel {
                width: 300px;
            }
        }
        
        @media (max-width: 767px) {
            .quick-actions-panel {
                width: 280px;
                padding: 1.5rem 1rem;
            }
        }
        
        @media (max-width: 576px) {
            .quick-actions-panel {
                width: 85%;
                max-width: 270px;
            }
            
            .action-button {
                padding: 1rem;
            }
        }

        /* Mobile Navigation Fix - Always visible */
        @media (max-width: 991px) {
            .sidebar-toggle, 
            .mobile-toggle {
                display: flex !important;
                visibility: visible !important;
                opacity: 1 !important;
                pointer-events: auto !important;
            }
            
            body::before {
                content: '';
                position: fixed;
                top: 10px;
                left: 10px;
                width: 50px;
                height: 50px;
                background: transparent;
                z-index: 9999;
                pointer-events: none;
            }
            
            body::after {
                content: '';
                position: fixed;
                top: 10px;
                right: 10px;
                width: 50px;
                height: 50px;
                background: transparent;
                z-index: 9999;
                pointer-events: none;
            }
        }

        /* Show-Hide Controls for Fixed Navigation */
        @media (min-width: 992px) {
            #fixedSidebarToggle, #fixedActionsToggle {
                display: none !important;
            }
        }
        
        /* Critical Mobile Styles */
        @media (max-width: 991px) {
            /* Sidebar absolute positioning for mobile */
            .sidebar {
                transform: translateX(-100%);
                width: 280px !important;
                height: 100vh !important;
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                z-index: 99998 !important; /* Very high z-index */
                box-shadow: 0 0 30px rgba(0, 0, 0, 0.2) !important;
                overflow-y: auto !important;
                transition: transform 0.3s ease !important;
                background-color: rgba(255, 255, 255, 0.98) !important;
                backdrop-filter: blur(10px) !important;
                padding: 2rem 1.5rem !important;
            }

            /* Active state for sidebar */
            .sidebar.active {
                transform: translateX(0) !important;
                display: block !important;
                visibility: visible !important;
                opacity: 1 !important;
            }

            /* Mobile overlay must be visible and above content */
            .mobile-overlay {
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                width: 100% !important;
                height: 100% !important;
                background: rgba(0, 0, 0, 0.5) !important;
                backdrop-filter: blur(3px) !important;
                z-index: 99997 !important;
                opacity: 0;
                visibility: hidden;
                transition: all 0.3s ease !important;
            }

            .mobile-overlay.active {
                opacity: 1 !important;
                visibility: visible !important;
            }

            /* Fixed navigation buttons must always be on top */
            #fixedSidebarToggle, #fixedActionsToggle {
                position: fixed !important;
                z-index: 99999 !important;
                display: flex !important;
                visibility: visible !important;
                opacity: 1 !important;
            }

            /* Quick actions panel */
            .quick-actions-panel {
                position: fixed !important;
                top: 0 !important;
                right: 0 !important;
                width: 280px !important;
                height: 100vh !important;
                z-index: 99998 !important;
                transform: translateX(100%);
                transition: transform 0.3s ease !important;
            }

            .quick-actions-panel.active {
                transform: translateX(0) !important;
            }

            /* Overlay for quick actions */
            .overlay {
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                width: 100% !important;
                height: 100% !important;
                background: rgba(0, 0, 0, 0.5) !important;
                backdrop-filter: blur(3px) !important;
                z-index: 99997 !important;
                opacity: 0;
                visibility: hidden;
                transition: all 0.3s ease !important;
            }

            .overlay.active {
                opacity: 1 !important;
                visibility: visible !important;
            }

            /* Main content adjustments */
            .main-content {
                margin-left: 0 !important;
                width: 100% !important;
                padding-top: calc(var(--header-height) + 1rem) !important;
            }

            .header-bar {
                left: 0 !important;
                padding: 0 70px !important;
            }
        }

        /* Critical Mobile Navigation Fix for Dashboard Style */
        @media (max-width: 991px) {
            .sidebar.active {
                display: flex !important;
                opacity: 1 !important;
                visibility: visible !important;
                transform: translateX(0) !important;
                z-index: 99999 !important;
                pointer-events: auto !important;
                height: 100vh !important;
                overflow-y: auto !important;
            }
            
            /* Force visibility of nav links */
            .sidebar.active .nav-link {
                display: flex !important;
                opacity: 1 !important;
                visibility: visible !important;
                width: 100% !important;
                color: var(--text-dark) !important;
                font-weight: 600 !important;
                padding: 0.75rem 1rem !important;
                margin-bottom: 0.5rem !important;
            }
            
            .sidebar.active .nav-link.active {
                background: linear-gradient(135deg, var(--gradient-start), var(--gradient-middle)) !important;
                color: white !important;
            }
            
            .sidebar.active .nav-link i {
                color: inherit !important;
                margin-right: 0.75rem !important;
                font-size: 1.2rem !important;
            }
            
            .sidebar.active .nav-link span {
                color: inherit !important;
                font-weight: 600 !important;
                font-size: 1.1rem !important;
            }
        }

        .map-container {
            width: 100%;
            height: 400px;
            background: white;
            border-radius: 24px;
            overflow: hidden;
            margin: 1rem 0;
            border: 1px solid rgba(0, 0, 0, 0.1);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }

        #map {
            width: 100%;
            height: 100%;
            border-radius: 24px;
        }

        /* Toast Notification */
        .toast {
            background: white;
            border-radius: 12px;
            border: none;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .toast-header {
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-middle));
            color: white;
            border-bottom: none;
            padding: 0.75rem 1rem;
        }

        .toast-body {
            padding: 1rem;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <!-- FIXED NAVIGATION BUTTONS -->
    <a href="#" id="fixedSidebarToggle" style="
        position: fixed;
        top: 10px;
        left: 10px; 
        width: 55px; 
        height: 55px; 
        background: linear-gradient(135deg, #FF6B6B, #FF9A8B);
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 15px rgba(255, 107, 107, 0.7);
        z-index: 999999;
        text-decoration: none;
        font-size: 1.5rem;">
        <i class="fas fa-bars"></i>
    </a>

    <a href="#" id="fixedActionsToggle" style="
        position: fixed;
        top: 10px;
        right: 10px; 
        width: 55px; 
        height: 55px; 
        background: linear-gradient(135deg, #FF6B6B, #FF9A8B);
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 15px rgba(255, 107, 107, 0.7);
        z-index: 999999;
        text-decoration: none;
        font-size: 1.5rem;">
        <i class="fas fa-ellipsis-v"></i>
    </a>

    <!-- Direct inline script for navigation functionality -->
    <script>
        // Immediately attach event listeners to fixed buttons
        document.addEventListener('DOMContentLoaded', function() {
            console.log("DOM fully loaded - attaching navigation handlers");
            
            // Get elements once
            const sidebar = document.getElementById('sidebar');
            const mobileOverlay = document.getElementById('mobileOverlay');
            const quickActionsPanel = document.getElementById('quickActionsPanel');
            const quickActionsOverlay = document.getElementById('quickActionsOverlay');
            
            // Critical fix: force sidebar to have display styles even before toggle
            if (sidebar) {
                sidebar.style.display = 'flex';
                sidebar.style.flexDirection = 'column';
                sidebar.style.opacity = '1';
                sidebar.style.visibility = 'visible';
            }
            
            // Toggle sidebar
            document.getElementById('fixedSidebarToggle').addEventListener('click', function(e) {
                e.preventDefault();
                console.log("Sidebar toggle clicked");
                
                sidebar.classList.toggle('active');
                mobileOverlay.classList.toggle('active');
                document.body.classList.toggle('sidebar-active');
                
                // Debug: log the sidebar styles
                console.log('Sidebar active state:', sidebar.classList.contains('active'));
                console.log('Sidebar display:', getComputedStyle(sidebar).display);
                console.log('Sidebar transform:', getComputedStyle(sidebar).transform);
                
                // Close quick actions if open
                quickActionsPanel.classList.remove('active');
                quickActionsOverlay.classList.remove('active');
            });
            
            // Toggle quick actions
            document.getElementById('fixedActionsToggle').addEventListener('click', function(e) {
                e.preventDefault();
                console.log("Actions toggle clicked");
                
                quickActionsPanel.classList.toggle('active');
                quickActionsOverlay.classList.toggle('active');
                document.body.classList.toggle('sidebar-active');
                
                // Close sidebar if open
                sidebar.classList.remove('active');
                mobileOverlay.classList.remove('active');
            });
            
            // Close sidebar when clicking overlay
            mobileOverlay.addEventListener('click', function() {
                sidebar.classList.remove('active');
                mobileOverlay.classList.remove('active');
                document.body.classList.remove('sidebar-active');
            });
            
            // Close quick actions when clicking overlay
            quickActionsOverlay.addEventListener('click', function() {
                quickActionsPanel.classList.remove('active');
                quickActionsOverlay.classList.remove('active');
                document.body.classList.remove('sidebar-active');
            });
            
            // Close panels when clicking menu items
            const menuItems = document.querySelectorAll('.nav-link');
            menuItems.forEach(item => {
                item.addEventListener('click', function() {
                    if (window.innerWidth < 992) {
                        setTimeout(() => {
                            sidebar.classList.remove('active');
                            mobileOverlay.classList.remove('active');
                            document.body.classList.remove('sidebar-active');
                        }, 150); // Small delay for better UX
                    }
                });
            });
            
            // Close quick actions with close button
            document.getElementById('closeQuickActions').addEventListener('click', function() {
                quickActionsPanel.classList.remove('active');
                quickActionsOverlay.classList.remove('active');
                document.body.classList.remove('sidebar-active');
            });
        });
    </script>

    <div class="gradient-background"></div>
    <div class="gradient-overlay"></div>
    
    <!-- Mobile Navigation Overlay -->
    <div class="mobile-overlay" id="mobileOverlay" style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.5); backdrop-filter: blur(3px); z-index: 99997; opacity: 0; visibility: hidden; transition: opacity 0.3s ease;"></div>
    
    <!-- Mobile Sidebar Toggle -->
    <button class="sidebar-toggle" id="sidebarToggle">
        <i class="fas fa-bars"></i>
    </button>
    
    <!-- Mobile Toggle Button (Right Side) -->
    <button class="mobile-toggle" id="mobileToggle">
        <i class="fas fa-ellipsis-v"></i>
    </button>
    
    <!-- Quick Actions Overlay -->
    <div id="quickActionsOverlay" style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.5); backdrop-filter: blur(3px); z-index: 99997; opacity: 0; visibility: hidden; transition: opacity 0.3s ease;"></div>
    
    <!-- Quick Actions Panel (Hidden by default) -->
    <div class="quick-actions-panel" id="quickActionsPanel" style="position: fixed; top: 0; right: 0; width: 280px; height: 100vh; background: white; z-index: 99998; padding: 2rem 1.5rem; overflow-y: auto; transform: translateX(100%); transition: transform 0.3s ease; box-shadow: -10px 0 30px rgba(0, 0, 0, 0.1); border-top-left-radius: 20px; border-bottom-left-radius: 20px;">
        <div class="quick-actions-header">
            <h5 class="mb-0">Quick Actions</h5>
            <button class="btn-close" id="closeQuickActions"></button>
        </div>
        <div class="quick-actions">
            <div class="glass-card action-button">
                <div class="d-flex align-items-center w-100">
                    <div class="action-icon me-3">
                        <i class="fas fa-share-alt" style="color: var(--gradient-middle)"></i>
                    </div>
                    <div>
                        <h6 class="mb-0 fw-bold">Share Location</h6>
                        <p class="text-muted mb-0 small">Share with trusted contacts</p>
                    </div>
                </div>
            </div>
            
            <div class="glass-card action-button">
                <div class="d-flex align-items-center w-100">
                    <div class="action-icon me-3">
                        <i class="fas fa-bell" style="color: var(--gradient-middle)"></i>
                    </div>
                    <div>
                        <h6 class="mb-0 fw-bold">View Alerts</h6>
                        <p class="text-muted mb-0 small">Check safety alerts in your area</p>
                    </div>
                </div>
            </div>
            
            <div class="glass-card action-button">
                <div class="d-flex align-items-center w-100">
                    <div class="action-icon me-3">
                        <i class="fas fa-phone-alt" style="color: var(--gradient-middle)"></i>
                    </div>
                    <div>
                        <h6 class="mb-0 fw-bold">Emergency Call</h6>
                        <p class="text-muted mb-0 small">Quick access to emergency services</p>
                    </div>
                </div>
            </div>
            
            <div class="glass-card action-button">
                <div class="d-flex align-items-center w-100">
                    <div class="action-icon me-3">
                        <i class="fas fa-route" style="color: var(--gradient-middle)"></i>
                    </div>
                    <div>
                        <h6 class="mb-0 fw-bold">Find Safe Route</h6>
                        <p class="text-muted mb-0 small">Navigate through safe areas</p>
                    </div>
                </div>
            </div>
            
            <div class="glass-card action-button">
                <div class="d-flex align-items-center w-100">
                    <div class="action-icon me-3">
                        <i class="fas fa-exclamation-triangle" style="color: #FF4545"></i>
                    </div>
                    <div>
                        <h6 class="mb-0 fw-bold">Report Emergency</h6>
                        <p class="text-muted mb-0 small">Get immediate assistance</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="dashboard-container">
        <!-- Mobile Navigation Overlay -->
        <div class="mobile-overlay" id="mobileOverlay"></div>
        
        <!-- Sidebar Navigation -->
        <aside class="sidebar" id="sidebar" style="transition: transform 0.3s ease; z-index: 99998; background-color: rgba(255, 255, 255, 0.98); box-shadow: 0 0 30px rgba(0, 0, 0, 0.2);">
            <div class="user-profile">
                <img src="https://i.pravatar.cc/150?img=32" alt="User Avatar" class="user-avatar">
                <div class="user-info">
                    <h6>Sarah Johnson</h6>
                    <small>Premium Member</small>
                </div>
            </div>
            
            <ul class="sidebar-nav" style="list-style: none; padding: 0;">
                <li class="nav-item">
                    <a href="dashboard.html" class="nav-link">
                        <i class="fas fa-home"></i>
                        Dashboard
                    </a>
                </li>
                <li class="nav-item">
                    <a href="safety-map.html" class="nav-link">
                        <i class="fas fa-map-marked-alt"></i>
                        Safety Map
                    </a>
                </li>
                <li class="nav-item">
                    <a href="live-tracker.html" class="nav-link active">
                        <i class="fas fa-location-arrow"></i>
                        Live Tracker
                    </a>
                </li>
                <li class="nav-item">
                    <a href="community.html" class="nav-link">
                        <i class="fas fa-users"></i>
                        Community
                    </a>
                </li>
                <li class="nav-item">
                    <a href="chatbot.html" class="nav-link">
                        <i class="fas fa-robot"></i>
                        AI Chatbot
                    </a>
                </li>
                <li class="nav-item mt-auto">
                    <a href="auth.html?action=logout" class="nav-link" id="logoutButton">
                        <i class="fas fa-sign-out-alt"></i>
                        Logout
                    </a>
                </li>
            </ul>
            
            <div class="sidebar-footer">
                <p class="mt-4 mb-0 text-muted small"> 2023 SafeJourney</p>
            </div>
        </aside>
        
        <!-- Header Bar -->
        <header class="header-bar">
            <div>
                <h4 class="m-0 d-flex align-items-center">
                    <i class="fas fa-map-marked-alt me-2"></i>
                    <span>Live Tracker</span>
                </h4>
            </div>
            
            <div class="d-flex align-items-center">
                <div class="dropdown me-3">
                    <button class="btn btn-light btn-sm position-relative" type="button" id="notificationsDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="fas fa-bell" style="color: var(--gradient-middle)"></i>
                        <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                            2
                        </span>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="notificationsDropdown">
                        <li><h6 class="dropdown-header">Notifications</h6></li>
                        <li><a class="dropdown-item" href="#">New safety alert in your area</a></li>
                        <li><a class="dropdown-item" href="#">Check-in reminder</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item small" href="#">View all notifications</a></li>
                    </ul>
                </div>
                
                <a href="auth.html" class="btn btn-primary btn-sm">
                    <i class="fas fa-user me-1"></i>
                    <span>Profile</span>
                </a>
            </div>
        </header>
        
        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Content Container -->
            <div class="container-fluid px-0">
                <div class="row">
                    <div class="col-lg-10 col-xl-8 mx-auto">
                        <!-- Live Tracking Content (main focus) -->
                        <div class="glass-card">
                            <div class="p-4">
                                <h5 class="mb-4 fw-bold">Live Safety Tracking</h5>
                                <!-- Initial Form -->
                                <div id="initialForm" class="scale-in">
                                    <form id="travelDetailsForm" class="needs-validation" novalidate onsubmit="return false;">
                                        <div class="mb-3">
                                            <label for="name" class="form-label">Full Name</label>
                                            <input type="text" class="form-control" id="name" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="phone" class="form-label">Emergency Contact Number</label>
                                            <input type="tel" class="form-control" id="phone" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="travelMode" class="form-label">Mode of Travel</label>
                                            <select class="form-select" id="travelMode" required>
                                                <option value="">Select travel mode</option>
                                                <option value="walking">Walking</option>
                                                <option value="cab">Cab</option>
                                                <option value="public">Public Transport</option>
                                                <option value="other">Other</option>
                                            </select>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="startPoint" class="form-label">Starting Point</label>
                                                <input type="text" class="form-control" id="startPoint" required>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="destination" class="form-label">Destination</label>
                                                <input type="text" class="form-control" id="destination" required>
                                            </div>
                                        </div>
                                        <button type="submit" class="btn btn-start-tracking w-100">
                                            <i class="fas fa-location-arrow me-2"></i> Start Tracking
                                        </button>
                                    </form>
                                </div>

                                <!-- Tracking View (Initially Hidden) -->
                                <div id="trackingView" style="display: none;">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="glass-card mb-4" id="statusIndicator">
                                                <div class="p-3 text-center">
                                                    <i class="fas fa-spinner fa-spin me-2"></i> Initializing tracking...
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row g-4">
                                        <div class="col-lg-8">
                                            <!-- Map Container -->
                                            <div class="glass-card p-0 overflow-hidden" style="height: 450px;">
                                                <div class="map-container">
                                                    <div id="map"></div>
                                                </div>
                                            </div>
                                    </div>

                                        <div class="col-lg-4">
                                            <div class="glass-card mb-4">
                                                <div class="p-3">
                                                    <h5 class="mb-3"><i class="fas fa-key me-2"></i> Security Code</h5>
                                                    <p class="small mb-2">For safety verification:</p>
                                                    <div id="trackingCode" class="tracking-code"></div>
                                                    <p class="small text-muted text-center">Only shows last 2 digits for security</p>
                                        </div>
                                    </div>

                                            <div class="glass-card mb-4">
                                                <div class="p-3">
                                                    <h5 class="mb-3"><i class="fas fa-clock me-2"></i> Next Check-in</h5>
                                                    <p class="small mb-2">Time until safety verification:</p>
                                                    <div id="countdown" class="timer-display">1:00</div>
                                        </div>
                                    </div>

                                            <div class="text-center mt-3">
                                                <button type="button" class="btn btn-end-tracking" id="endTracking">
                                                    <i class="fas fa-stop-circle me-2"></i> End Tracking
                                    </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Page Footer -->
            <footer class="mt-4 mb-3 text-center">
                <div class="glass-card">
                    <div class="p-3">
                        <p class="mb-2 text-muted"> 2023 SafeJourney - Your safety is our priority</p>
                        <div class="d-flex justify-content-center">
                            <a href="#" class="me-3 text-decoration-none" style="color: var(--gradient-middle)">Privacy Policy</a>
                            <a href="#" class="me-3 text-decoration-none" style="color: var(--gradient-middle)">Terms of Service</a>
                            <a href="#" class="text-decoration-none" style="color: var(--gradient-middle)">Contact Us</a>
                        </div>
                    </div>
                </div>
            </footer>
        </main>
    </div>

    <!-- Verification Code Setup Modal -->
    <div class="modal fade" id="verificationSetupModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content" style="border-radius: 24px; border: 1px solid rgba(0, 0, 0, 0.1);">
                <div class="modal-header border-0">
                    <h5 class="modal-title">
                        <i class="fas fa-key me-2" style="color: var(--gradient-middle);"></i> 
                        Set Your Security Code
                    </h5>
                </div>
                <div class="modal-body">
                    <div class="alert alert-info" style="border-radius: 12px;">
                        <i class="fas fa-info-circle me-2"></i> 
                        This 6-digit code will be used to verify your safety during tracking. Make sure you remember it!
                    </div>
                    
                    <div class="form-group mb-4">
                        <label for="securityCodeInput" class="form-label">Enter a 6-digit numeric code</label>
                        <input type="text" class="form-control form-control-lg text-center" id="securityCodeInput" 
                               maxlength="6" placeholder="Example: 123456" required>
                        <div class="invalid-feedback">Please enter a 6-digit numeric code.</div>
                    </div>
                    
                    <div class="form-group mb-3">
                        <label for="confirmSecurityCode" class="form-label">Confirm your code</label>
                        <input type="text" class="form-control form-control-lg text-center" id="confirmSecurityCode" 
                               maxlength="6" placeholder="Confirm your code" required>
                        <div class="invalid-feedback">Codes don't match.</div>
                    </div>
                </div>
                <div class="modal-footer border-0">
                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveSecurityCode">
                        <i class="fas fa-check me-2"></i> Confirm & Start Tracking
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Safety Check Modal -->
    <div class="modal fade" id="safetyCheckModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content" style="border-radius: 24px; border: 1px solid rgba(0, 0, 0, 0.1);">
                <div class="modal-header border-0">
                    <h5 class="modal-title">
                        <i class="fas fa-shield-alt me-2" style="color: var(--gradient-middle);"></i> 
                        Safety Check
                    </h5>
                </div>
                <div class="modal-body">
                    <div class="alert alert-warning" style="background: rgba(255, 154, 139, 0.1); border: 1px solid rgba(255, 154, 139, 0.3); border-radius: 12px;">
                        <i class="fas fa-info-circle me-2"></i> 
                        <strong>Safety Check Required:</strong> Please enter your 6-digit security code to confirm your safety.
                    </div>
                    
                    <div class="glass-card p-4 mb-3">
                        <h6 class="text-center mb-3">Enter your security code</h6>
                        <div class="form-group">
                            <input type="text" class="form-control form-control-lg text-center" id="safetyCodeInput" 
                                maxlength="6" placeholder="Enter your 6-digit code" autofocus>
                        </div>
                    </div>
                    
                    <div class="alert alert-danger mt-3" id="codeError" style="display: none; border-radius: 12px;">
                        <i class="fas fa-exclamation-circle me-2"></i> 
                        Incorrect code! Please try again.
                    </div>
                    
                    <div class="d-flex justify-content-center">
                        <div id="errorCountdown" class="mt-2 text-danger" style="display: none;">
                            Emergency alert will be triggered in <span id="errorCountdownTime">30</span> seconds
                        </div>
                    </div>
                </div>
                <div class="modal-footer border-0">
                    <button type="button" class="btn btn-primary w-100" id="confirmSafety">
                        <i class="fas fa-check me-2"></i> Confirm Safety
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast notification template -->
    <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
        <div id="notificationToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <i class="fas fa-bell me-2"></i>
                <strong class="me-auto" id="toastTitle">Notification</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body" id="toastMessage">
                Notification message will appear here.
            </div>
        </div>
    </div>

    <!-- Audio elements -->
    <audio id="alertSound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-alarm-digital-clock-beep-989.mp3" type="audio/mpeg">
    </audio>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Load tracking scripts -->
    <script>
        // Ensure scripts are loaded in proper order and only once
        if (!window.scriptsLoaded) {
            window.scriptsLoaded = true;
            
            // Function to load a script and return a promise
            function loadScript(src) {
                return new Promise((resolve, reject) => {
                    if (document.querySelector(`script[src="${src}"]`)) {
                        console.log(`Script ${src} already loaded, skipping`);
                        resolve();
                        return;
                    }
                    
                    const script = document.createElement('script');
                    script.src = src;
                    script.onload = () => {
                        console.log(`Script ${src} loaded successfully`);
                        resolve();
                    };
                    script.onerror = (e) => {
                        console.error(`Error loading script ${src}:`, e);
                        reject(e);
                    };
                    document.body.appendChild(script);
                });
            }
            
            // Load scripts in sequence
            (async function() {
                try {
                    // Load emergency contacts script first
                    await loadScript('emergency-contacts.js');
                    // Then load live tracker script
                    await loadScript('live-tracker.js');
                    console.log('All tracking scripts loaded successfully');
                } catch (error) {
                    console.error('Error loading tracking scripts:', error);
                }
            })();
        }
    </script>
    
    <!-- Firebase Authentication Script -->
    <script>
        // Handle logout
        document.addEventListener('DOMContentLoaded', function() {
            const logoutButton = document.getElementById('logoutButton');
            if (logoutButton) {
                logoutButton.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Show confirmation dialog
                    if (confirm('Are you sure you want to log out?')) {
                        firebase.auth().signOut()
                            .then(() => {
                                console.log('User signed out successfully');
                                // Set flag to indicate explicit visit to auth page and pass logout action parameter
                                sessionStorage.setItem('explicitAuthVisit', 'true');
                                window.location.href = 'auth.html?action=logout';
                            })
                            .catch((error) => {
                                console.error('Sign out error:', error);
                                alert('Error signing out. Please try again.');
                            });
                    }
                });
            }
        });
    </script>
    
    <!-- Mobile Navigation Script -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const sidebar = document.getElementById('sidebar');
            const sidebarToggle = document.getElementById('sidebarToggle');
            const mobileToggle = document.getElementById('mobileToggle');
            const mobileOverlay = document.getElementById('mobileOverlay');
            const quickActionsPanel = document.getElementById('quickActionsPanel');
            const quickActionsOverlay = document.getElementById('quickActionsOverlay');
            const closeQuickActions = document.getElementById('closeQuickActions');
            const headerBar = document.querySelector('.header-bar');
            const mainContent = document.querySelector('.main-content');
            
            // Force mobile layout on smaller screens
            forceMobileLayout();
            
            // Function to force mobile layout on smaller screens
            function forceMobileLayout() {
                if (window.innerWidth < 992) {
                    // Force mobile view
                    if (mainContent) {
                        mainContent.style.marginLeft = '0';
                        mainContent.style.width = '100%';
                    }
                    
                    if (headerBar) {
                        headerBar.style.left = '0';
                    }
                    
                    // Make mobile toggles visible
                    if (sidebarToggle) {
                        sidebarToggle.style.display = 'flex';
                        sidebarToggle.style.opacity = '1';
                    }
                    
                    if (mobileToggle) {
                        mobileToggle.style.display = 'flex';
                        mobileToggle.style.opacity = '1';
                    }
                    
                    // Add inline mobile styles for absolute certainty
                    document.head.insertAdjacentHTML('beforeend', `
                        <style id="mobile-fix">
                            @media (max-width: 991px) {
                                .sidebar-toggle, .mobile-toggle {
                                    display: flex !important;
                                    opacity: 1 !important;
                                }
                                .main-content {
                                    margin-left: 0 !important;
                                }
                                .header-bar {
                                    left: 0 !important;
                                }
                            }
                        </style>
                    `);
                } else {
                    if (mainContent) {
                        mainContent.style.marginLeft = `var(--sidebar-width)`;
                    }
                    
                    if (headerBar) {
                        headerBar.style.left = `var(--sidebar-width)`;
                    }
                    
                    if (sidebarToggle) {
                        sidebarToggle.style.display = 'none';
                    }
                    
                    if (mobileToggle) {
                        mobileToggle.style.display = 'none';
                    }
                }
            }
            
            // Toggle sidebar on mobile
            if (sidebarToggle) {
                sidebarToggle.addEventListener('click', function(e) {
                    console.log('Sidebar toggle clicked'); // Debug log
                    e.preventDefault();
                    e.stopPropagation();
                    sidebar.classList.toggle('active');
                    mobileOverlay.classList.toggle('active');
                    document.body.classList.toggle('sidebar-active');
                    
                    // Close quick actions panel if open
                    quickActionsPanel.classList.remove('active');
                    quickActionsOverlay.classList.remove('active');
                });
            }
            
            // Toggle quick actions panel
            if (mobileToggle) {
                mobileToggle.addEventListener('click', function(e) {
                    console.log('Mobile toggle clicked'); // Debug log
                    e.preventDefault();
                    e.stopPropagation();
                    quickActionsPanel.classList.toggle('active');
                    quickActionsOverlay.classList.toggle('active');
                    document.body.classList.toggle('sidebar-active');
                    
                    // Close sidebar if open
                    sidebar.classList.remove('active');
                    mobileOverlay.classList.remove('active');
                });
            }
            
            // Close quick actions when clicking on overlay
            if (quickActionsOverlay) {
                quickActionsOverlay.addEventListener('click', function() {
                    quickActionsPanel.classList.remove('active');
                    quickActionsOverlay.classList.remove('active');
                    document.body.classList.remove('sidebar-active');
                });
            }
            
            // Close quick actions with close button
            if (closeQuickActions) {
                closeQuickActions.addEventListener('click', function() {
                    quickActionsPanel.classList.remove('active');
                    quickActionsOverlay.classList.remove('active');
                    document.body.classList.remove('sidebar-active');
                });
            }
            
            // Close sidebar when clicking on overlay
            if (mobileOverlay) {
                mobileOverlay.addEventListener('click', function() {
                    sidebar.classList.remove('active');
                    mobileOverlay.classList.remove('active');
                    document.body.classList.remove('sidebar-active');
                });
            }
            
            // Close sidebar when clicking on a menu item on mobile
            const menuItems = document.querySelectorAll('.nav-link');
            menuItems.forEach(item => {
                item.addEventListener('click', function() {
                    if (window.innerWidth < 992) {
                        setTimeout(() => {
                            sidebar.classList.remove('active');
                            mobileOverlay.classList.remove('active');
                            document.body.classList.remove('sidebar-active');
                        }, 150); // Small delay for better UX
                    }
                });
            });
            
            // Add click handler for action buttons
            const actionButtons = document.querySelectorAll('.action-button');
            actionButtons.forEach(button => {
                button.addEventListener('click', function() {
                    // Handle action button click (show toast notification for demo)
                    const action = this.querySelector('h6').textContent;
                    showNotification(`${action}`, 'Action triggered successfully');
                    
                    // Close quick actions panel
                    quickActionsPanel.classList.remove('active');
                    quickActionsOverlay.classList.remove('active');
                    document.body.classList.remove('sidebar-active');
                });
            });
            
            // Function to show toast notification
            function showNotification(title, message) {
                const toastTitle = document.getElementById('toastTitle');
                const toastMessage = document.getElementById('toastMessage');
                const toast = document.getElementById('notificationToast');
                
                if (toastTitle && toastMessage && toast) {
                    toastTitle.textContent = title;
                    toastMessage.textContent = message;
                    
                    const bsToast = new bootstrap.Toast(toast);
                    bsToast.show();
                }
            }
            
            // Handle window resize
            window.addEventListener('resize', function() {
                forceMobileLayout();
                
                if (window.innerWidth >= 992) {
                    sidebar.classList.remove('active');
                    mobileOverlay.classList.remove('active');
                    quickActionsPanel.classList.remove('active');
                    quickActionsOverlay.classList.remove('active');
                    document.body.classList.remove('sidebar-active');
                }
            });
            
            // Mouse move effect for gradient overlay
            document.addEventListener('mousemove', function(e) {
                document.documentElement.style.setProperty('--mouse-x', e.clientX + 'px');
                document.documentElement.style.setProperty('--mouse-y', e.clientY + 'px');
            });
            
            // Initialize form submit handler
            const travelDetailsForm = document.getElementById('travelDetailsForm');
            if (travelDetailsForm) {
                travelDetailsForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    // Simple form validation
                    const form = e.target;
                    if (!form.checkValidity()) {
                        e.stopPropagation();
                        form.classList.add('was-validated');
                        return;
                    }
                    
                    // Generate a random tracking code
                    const trackingCode = Math.random().toString(36).substring(2, 8).toUpperCase();
                    
                    // Update the tracking code display
                    const trackingCodeDisplay = document.getElementById('trackingCode');
                    if (trackingCodeDisplay) {
                        trackingCodeDisplay.textContent = trackingCode;
                    }
                    
                    // Hide the form and show the tracking view
                    const initialForm = document.getElementById('initialForm');
                    const trackingView = document.getElementById('trackingView');
                    
                    if (initialForm && trackingView) {
                        initialForm.style.display = 'none';
                        trackingView.style.display = 'block';
                    }
                    
                    // Show success notification
                    showNotification('Tracking Started', 'Your safety tracking has been initiated successfully.');
                    
                    // Initialize the map
                    initMap();
                });
            }
        });
    </script>

    <!-- Additional mobile navigation enhancements -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Check if we are in mobile view
            function isMobileView() {
                return window.innerWidth < 992;
            }
            
            // Disable old mobile navigation buttons
            const oldButtons = document.querySelectorAll('.sidebar-toggle, .mobile-toggle');
            oldButtons.forEach(button => {
                button.style.display = 'none';
                button.style.visibility = 'hidden';
                button.style.opacity = '0';
                button.style.pointerEvents = 'none';
            });
            
            // Add click event to all sidebar menu items
            const menuItems = document.querySelectorAll('.nav-link');
            menuItems.forEach(item => {
                item.addEventListener('click', function() {
                    if (isMobileView()) {
                        console.log('Menu item clicked, closing sidebar');
                        const sidebar = document.getElementById('sidebar');
                        const overlay = document.getElementById('mobileOverlay');
                        
                        sidebar.classList.remove('active');
                        overlay.classList.remove('active');
                        document.body.classList.remove('sidebar-active');
                    }
                });
            });
            
            // Log mobile navigation state for debugging
            console.log('Mobile Navigation Setup:');
            console.log('- Fixed sidebar toggle visible:', document.getElementById('fixedSidebarToggle').style.display);
            console.log('- Fixed actions toggle visible:', document.getElementById('fixedActionsToggle').style.display);
            console.log('- Sidebar z-index:', getComputedStyle(document.getElementById('sidebar')).zIndex);
            console.log('- Mobile overlay z-index:', getComputedStyle(document.getElementById('mobileOverlay')).zIndex);
            
            // Add window resize handler
            window.addEventListener('resize', function() {
                if (isMobileView()) {
                    // Ensure mobile view is enforced
                    const mainContent = document.querySelector('.main-content');
                    const headerBar = document.querySelector('.header-bar');
                    
                    if (mainContent) {
                        mainContent.style.marginLeft = '0';
                        mainContent.style.width = '100%';
                    }
                    
                    if (headerBar) {
                        headerBar.style.left = '0';
                    }
                }
            });
        });
    </script>

    <!-- Initialize and display the map -->
    <script>
        // Basic initMap to be overridden by live-tracker.js
        function initMap() {
            console.log("Basic map initialization - will be overridden by live-tracker.js");
            
            // This will be replaced by the more detailed implementation in live-tracker.js
            // It's just here to satisfy the Google Maps API callback
        }
    </script>

    <!-- Emergency Contact Modal -->
    <div class="modal fade" id="emergencyContactModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content" style="border-radius: 24px; border: 1px solid rgba(0, 0, 0, 0.1);">
                <div class="modal-header border-0">
                    <h5 class="modal-title">
                        <i class="fas fa-phone-alt me-2" style="color: var(--gradient-middle);"></i> 
                        Emergency Contact Setup
                    </h5>
                </div>
                <div class="modal-body">
                    <div class="alert alert-info" style="border-radius: 12px;">
                        <i class="fas fa-info-circle me-2"></i> 
                        These contacts will be notified in case of an emergency. Add at least one primary contact.
                    </div>
                    
                    <div id="contactsList">
                        <!-- Contact items will be added here dynamically -->
                        <div class="glass-card mb-3 contact-item">
                            <div class="row g-3">
                                <div class="col-md-4">
                                    <label for="contactName1" class="form-label">Contact Name</label>
                                    <input type="text" class="form-control" id="contactName1" required>
                                </div>
                                <div class="col-md-4">
                                    <label for="contactPhone1" class="form-label">Phone Number</label>
                                    <input type="tel" class="form-control" id="contactPhone1" required>
                                </div>
                                <div class="col-md-3">
                                    <label for="contactRelation1" class="form-label">Relationship</label>
                                    <select class="form-select" id="contactRelation1">
                                        <option value="Family">Family</option>
                                        <option value="Friend">Friend</option>
                                        <option value="Colleague">Colleague</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </div>
                                <div class="col-md-1 d-flex align-items-end">
                                    <button type="button" class="btn btn-outline-danger mb-3" onclick="removeContact(this)">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <button type="button" id="addContactBtn" class="btn btn-outline-primary mt-2">
                        <i class="fas fa-plus me-2"></i> Add Another Contact
                    </button>
                </div>
                <div class="modal-footer border-0">
                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveContacts">
                        <i class="fas fa-save me-2"></i> Save Contacts & Continue
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Logout Button Handler -->
    <script>
        document.getElementById('logoutButton').addEventListener('click', function() {
            // If tracking is active, ensure it gets stopped properly
            if (typeof trackerActive !== 'undefined' && trackerActive) {
                stopTracking();
            }
            
            // Clear any stored security codes or emergency contacts
            localStorage.removeItem('securityCode');
            localStorage.removeItem('emergencyContacts');
            
            // If Firebase is initialized, sign out the user
            if (typeof firebase !== 'undefined' && firebase.auth) {
                firebase.auth().signOut().then(function() {
                    console.log('User signed out successfully');
                    // Set a flag in sessionStorage to indicate intentional logout
                    sessionStorage.setItem('userLoggedOut', 'true');
                    // Redirect to auth page with logout parameter
                    window.location.href = 'auth.html?action=logout';
                }).catch(function(error) {
                    console.error('Sign out error:', error);
                    // Even if there's an error, try to redirect
                    window.location.href = 'auth.html?action=logout';
                });
            } else {
                console.log('Firebase not initialized, redirecting directly');
                sessionStorage.setItem('userLoggedOut', 'true');
                window.location.href = 'auth.html?action=logout';
            }
        });
    </script>
</body>
</html> 